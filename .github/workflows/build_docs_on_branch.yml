name: BR
## this action is here only for the development phase of docarray v2
## it will be removed once the new version is released
on:
  push:
    branches:
      - feat-rewrite-v2
      - test-build-doc

jobs:

  deploy-to-netlify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.5.0
      - uses: actions/setup-python@v4
        with:
          python-version: 3.7
      - uses: actions/setup-node@v2
        with:
          node-version: '14'
      - name: Build and Deploy
        run: |
          npm i -g netlify-cli
          python -m pip install --upgrade pip
          python -m pip install poetry
          python -m poetry config virtualenvs.create false && python -m poetry install --no-interaction --no-ansi --all-extras

          cd docs
          bash makedocs.sh
          cd ..
          netlify deploy --dir=site --alias="docarray-v2" --message="Deploying docs to docarray v2"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN1 }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
